// delete_all_chats
// すべての自分の発言(chat_id)を巡回取得して全削除
(async()=>{const p=250,s=ms=>new Promise(r=>setTimeout(r,ms)),urls=[location.href,...[...document.querySelectorAll('.pager_numbers a,.pager_left a,.pager_right a')].map(a=>a.href)],ids=new Set;for(const u of urls){try{const h=await fetch(u,{credentials:'same-origin'}).then(r=>r.text()),d=new DOMParser().parseFromString(h,'text/html');d.querySelectorAll('form.chat_menu input[name="chat_id"]').forEach(i=>ids.add(i.value))}catch(e){console.error('取得失敗',u,e)}}for(const id of ids){const q=new URLSearchParams([['chat_id',id],['delete','発言を削除する']]);try{const r=await fetch('area.php#chat',{method:'POST',body:q,credentials:'same-origin'});console.log('削除',id,r.status)}catch(e){console.error('失敗',id,e)}await s(p)}console.log('全削除完了')})();
